:root{
  /* Core palette – dark mode (ink / charcoal) */
  --bg:#0f1115;                /* ink black */
  --paper:#161a20;             /* subtle lift */
  --paper2:#14181e;
  --card:#1b2027;

  --text:#f3f4f6;              /* soft white */
  --muted:#9aa3b2;             /* cool grey */
  --border: rgba(255,255,255,.08);
  --shadow: rgba(0,0,0,.38);   /* softened */

  /* Accent – restrained vermilion (torii-inspired, but subtle) */
  --accent:#b11226;            /* deep vermilion */
  --accentSoft: rgba(177,18,38,.18);

  /* Keep legacy vars for compatibility with existing CSS */
  --indigo: var(--accent);
  --vermilion: var(--accent);
  --sakura: rgba(255, 200, 210, .35);

  --good:#4fbf8f;
  --almost:#c08a2e;
  --bad:#d64545;

  --focus: rgba(177,18,38,.22);
  --input:#12161c;
  --overlay: rgba(0,0,0,.60);

  --radius:18px;
  --btnRadius:12px;
  --tap: 44px;
}

@media (prefers-color-scheme: light){
  :root{
    /* Light mode – washi paper */
    --bg:#f5f3ef;
    --paper:#ffffff;
    --paper2:#faf9f7;
    --card:#ffffff;

    --text:#1c1f24;
    --muted:#6b7280;
    --border: rgba(0,0,0,.08);
    --shadow: rgba(0,0,0,.06); /* softened */

    --accent:#b11226;
    --accentSoft: rgba(177,18,38,.14);

    /* Keep legacy vars for compatibility */
    --indigo: var(--accent);
    --vermilion: var(--accent);
    --sakura: rgba(255, 200, 210, .28);

    --good:#158a5f;
    --almost:#9a6b1a;
    --bad:#b42323;

    --focus: rgba(177,18,38,.18);
    --input:#ffffff;
    --overlay: rgba(0,0,0,.28);
  }
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color:var(--text);
  background: var(--bg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* iOS PWA (standalone) status bar handling
   - With apple-mobile-web-app-status-bar-style=black-translucent, iOS draws white status icons.
   - Add a very subtle scrim behind the status bar area in light mode for legibility,
     while keeping an edge-to-edge background. */
body::before{
  content:"";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: env(safe-area-inset-top);
  pointer-events: none;
  z-index: 5;
  background: rgba(0,0,0,.0); /* dark mode: effectively off */
}
@media (prefers-color-scheme: light){
  body::before{
    background: rgba(0,0,0,.10);
  }
}

.wrap{
  max-width: 980px;
  margin: 0 auto;
  padding: calc(env(safe-area-inset-top) + 14px) 14px calc(env(safe-area-inset-bottom) + 18px);
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:12px;
}

/* Brand logo */
.brand{
  display:inline-flex;
  align-items:center;
  user-select:none;
  line-height:1;
  color: var(--text); /* ensures SVG currentColor matches theme */
}

.brandLogo{
  height: 38px;
  width: auto;
  display:block;
}

button{
  border:1px solid var(--border);
  background: color-mix(in oklab, var(--bg) 55%, var(--card));
  color:var(--text);
  border-radius: var(--btnRadius);
  padding: 9px 11px;
  cursor:pointer;
  font-size:14px;
  min-height: 40px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  line-height: 1;
}

button.primary{
  background: var(--accent);
  border-color: var(--accent);
  color:#fff;
}
button.primary:hover{
  background: color-mix(in oklab, var(--accent) 85%, black);
}

button.ghost{
  background: color-mix(in oklab, var(--bg) 68%, var(--card));
}
button.icon{
  width: 44px;
  height: 44px;
  padding: 0;
  border-radius: 14px;
  min-height: 44px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
/* SVG ensures true centering */
.icon svg{
  width: 22px;
  height: 22px;
  display:block;
}
.iconGlyph{
  font-size: 20px;
  line-height: 1;
  display:block;
  opacity: .95;
}
button:disabled{opacity:.5;cursor:not-allowed}

.mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

.card{
  border:1px solid var(--border);
  border-radius: var(--radius);
  background: linear-gradient(180deg, var(--card), var(--paper2));
  box-shadow: 0 10px 22px var(--shadow); /* reduced */
  padding: 16px;
  position: relative;
  overflow:hidden;
}
.card::before{
  content:"";
  position:absolute;
  inset:-2px;
  background: radial-gradient(560px 240px at 18% 0%,
    var(--accentSoft),
    transparent 62%
  );
  opacity:.45; /* reduced */
  pointer-events:none;
}
.card > *{position:relative}

.stack{
  display:grid;
  gap:12px;
}

.promptCard{
  text-align:center;
  padding-top: 18px;
  padding-bottom: 14px;
}

/* Default prompt font (rounded/system) */
.bigPrompt{
  font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  font-size: clamp(46px, 9vw, 76px);
  line-height:1.05;
  margin: 6px 0 10px;
  letter-spacing:.5px;
  white-space: pre-wrap;
  text-shadow: 0 6px 18px color-mix(in oklab, var(--accent) 8%, transparent); /* reduced */
}

/* Optional Mincho/serif prompt font */
html.kanaSerif .bigPrompt{
  font-family:
    "Hiragino Mincho ProN",
    "Hiragino Mincho Pro",
    "Yu Mincho",
    "YuMincho",
    "Hiragino Serif",
    "Noto Serif JP",
    ui-serif,
    Georgia,
    serif;
  letter-spacing: .3px;
}

/* Optional: emphasise word gaps when 'Show spaces' is enabled */
html.showSpaces .bigPrompt{
  word-spacing: 0.3em;
}

.promptMeta{
  display:flex;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
  color:var(--muted);
  font-size:12px;
  border-top:1px solid var(--border);
  padding-top:10px;
  margin-top:8px;
}

.result{
  border:1px solid var(--border);
  border-radius: var(--radius);
  background: linear-gradient(180deg, var(--paper), var(--paper2));
  box-shadow: 0 8px 18px var(--shadow); /* reduced */
  padding: 14px 14px;
  min-height: 124px;
}
.status{
  margin:0 0 10px;
  font-weight:950;
  letter-spacing:.2px;
  display:flex;
  align-items:center;
  gap:10px;
}
.status.good{color:var(--good)}
.status.almost{color:var(--almost)}
.status.bad{color:var(--bad)}

.defBox{
  border:1px solid var(--border);
  border-radius: 16px;
  padding:12px 12px;
  background: color-mix(in oklab, var(--bg) 35%, var(--card));
  margin:10px 0 10px;
}
.defLabel{margin:0 0 4px;color:var(--muted);font-size:12px}
.defText{margin:0;font-size:19px;font-weight:950;line-height:1.25}
.mini{margin:6px 0;color:var(--muted);font-size:13px;line-height:1.45}

/* Make the text entry section the focal point + center aligned */
.answerCard{
  padding-top: 14px;
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
  box-shadow:
    0 12px 28px var(--shadow), /* reduced */
    0 0 0 1px color-mix(in oklab, var(--accent) 8%, transparent); /* reduced */
  text-align:center;
}
.answerCard::before{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(
    180deg,
    var(--accentSoft),
    transparent 60%
  );
  opacity:.45; /* reduced */
  pointer-events:none;
}
.answerInner{
  max-width: 560px;
  margin: 0 auto;
}

input[type="text"]{
  width:100%;
  border:1px solid var(--border);
  background: var(--input);
  color:var(--text);
  border-radius: 14px;
  padding: 13px 12px;
  font-size:18px;
  min-height: calc(var(--tap) + 4px);
  outline:none;
  text-align:center;
}
input[type="text"]:focus{
  border-color: color-mix(in oklab, var(--accent) 70%, var(--border));
  box-shadow: 0 0 0 4px var(--focus);
}

.btns{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
  justify-content:center;
}
.btns button{
  min-height: 40px;
  padding: 9px 11px;
  border-radius: 12px;
  font-size: 13.5px;
}

.bottom{
  margin-top: 12px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap:10px;
}
.statCard{
  border:1px solid var(--border);
  border-radius: var(--radius);
  background: linear-gradient(180deg, var(--card), var(--paper2));
  box-shadow: 0 8px 18px var(--shadow); /* reduced */
  padding: 12px 12px;
  min-height: 84px;
  min-width: 0;
}
.statLabel{margin:0 0 2px;color:var(--muted);font-size:12px}
.statValue{margin:0;font-size:26px;font-weight:950;letter-spacing:.2px;line-height:1.05}
.statSub{margin:6px 0 0;color:var(--muted);font-size:12px;line-height:1.35}

/* Trouble card affordance + pulses */
.troubleCard{
  cursor: pointer;
  user-select: none;
}
.troubleCard:focus{
  outline: none;
  box-shadow:
    0 8px 18px var(--shadow),
    0 0 0 4px var(--focus);
}

@keyframes troubleAddPulse{
  0%{ transform: translateY(0) scale(1); box-shadow: 0 8px 18px var(--shadow); }
  25%{ transform: translateY(-1px) scale(1.03); box-shadow: 0 14px 26px var(--shadow); }
  60%{ transform: translateY(0) scale(1.01); }
  100%{ transform: translateY(0) scale(1); }
}
@keyframes troubleRemovePulse{
  0%{ transform: translateY(0) scale(1); box-shadow: 0 8px 18px var(--shadow); }
  35%{ transform: translateY(0) scale(0.985); }
  65%{ transform: translateY(0) scale(1.01); }
  100%{ transform: translateY(0) scale(1); }
}
.troubleCard.pulseAdd{
  border-color: color-mix(in oklab, var(--bad) 45%, var(--border));
  animation: troubleAddPulse .42s ease;
}
.troubleCard.pulseRemove{
  border-color: color-mix(in oklab, var(--good) 45%, var(--border));
  animation: troubleRemovePulse .46s ease;
}

.pills{
  margin-top: 10px;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
}
.pill{
  font-size:12px;color:var(--muted);
  border:1px solid var(--border);
  padding:6px 10px;
  border-radius:999px;
  background: color-mix(in oklab, var(--bg) 55%, var(--card));
  white-space:nowrap;
}

/* Pool size line in Settings */
.poolCountLine{
  margin: 8px 0 2px;
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: color-mix(in oklab, var(--bg) 62%, var(--card));
  color: var(--muted);
  font-size: 12.5px;
  line-height: 1.35;
}

/* Sentence category box behavior */
.sentenceCatBox{
  margin-top: 6px;
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 14px;
  background: color-mix(in oklab, var(--bg) 62%, var(--card));
}
.sentenceCatBox.collapsed{
  display:none;
}
.sentenceCatBox.disabled{
  opacity: .55;
  filter: grayscale(.2);
  pointer-events: none;
}

/* Keep metrics in a single row on mobile (shrink rather than stack) */
@media (max-width: 640px){
  .bottom{grid-template-columns: repeat(3, minmax(0, 1fr));}
  .statCard{padding:10px; min-height:76px}
  .statValue{font-size:22px}
  .statLabel{font-size:11px}
  .statSub{font-size:11px; margin-top:4px}
}
@media (max-width: 420px){
  .bottom{grid-template-columns: repeat(3, minmax(0, 1fr));}
  .statCard{padding:9px; min-height:72px}
  .statValue{font-size:20px}
  .statLabel{font-size:10.5px}
  .statSub{font-size:10.5px}
}

@media (max-width: 520px){
  .card{padding:14px}
  .bigPrompt{font-size: clamp(44px, 11vw, 64px)}
  .btns{gap:8px}
  .btns button{font-size:13px}
  .statValue{font-size:24px}
  .pill{font-size:11.5px}
  input[type="text"]{font-size:18px}
  .brandLogo{height:34px}
}

/* Drawer */
.drawerOverlay{
  position:fixed;
  inset:0;
  background: var(--overlay);
  opacity:0;
  pointer-events:none;
  transition: opacity .18s ease;
  z-index: 50;
}
.drawerOverlay.open{opacity:1;pointer-events:auto}

.drawer{
  position:fixed;
  top:0;
  right:0;
  height:100%;
  width: min(380px, 92vw);
  background: linear-gradient(180deg, var(--paper), var(--paper2));
  border-left: 1px solid var(--border);
  box-shadow: -14px 0 28px var(--shadow); /* reduced */
  transform: translateX(102%);
  transition: transform .22s ease;
  z-index: 60;
  padding: calc(env(safe-area-inset-top) + 14px) 14px calc(env(safe-area-inset-bottom) + 16px);
  overflow:auto;
}
.drawer.open{transform: translateX(0)}
.drawerHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom: 10px;
}

/* ✅ Bigger "Settings" heading */
.drawerTitle{
  margin:0;
  font-size:18px;      /* was 14px */
  font-weight: 950;
  letter-spacing: .2px;
}

.drawerSection{
  border-top:1px solid var(--border);
  padding-top:12px;
  margin-top:12px;
}
.drawerSection:first-of-type{border-top:none;padding-top:0;margin-top:0}
.drawerSection h2{margin:0 0 10px;font-size:13px}
label{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px;margin:8px 0}
select{
  width:100%;
  border:1px solid var(--border);
  background: var(--input);
  color:var(--text);
  border-radius:12px;
  padding:10px 10px;
  font-size:14px;
  min-height: var(--tap);
  outline:none;
}
.hintBox{
  border:1px dashed var(--border);
  border-radius:14px;
  padding:10px 12px;
  background: color-mix(in oklab, var(--bg) 22%, var(--card));
  color:var(--muted);
  font-size:12px;
  line-height:1.4;
  margin-top:10px;
}
.kbd{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
  border:1px solid var(--border);
  border-radius:10px;
  padding:4px 8px;
  color:var(--muted);
  background: color-mix(in oklab, var(--bg) 25%, var(--card));
  display:inline-block;
  margin:2px 6px 2px 0;
}

/* Tutorial / Help modal */
.modalOverlay{
  position:fixed; inset:0;
  background: var(--overlay);
  opacity:0;
  pointer-events:none;
  transition: opacity .18s ease;
  z-index: 80;
}
.modalOverlay.open{opacity:1;pointer-events:auto}
.modal{
  position:fixed;
  left:50%; top:50%;
  transform: translate(-50%,-50%) scale(.98);
  width:min(560px, 92vw);
  background: linear-gradient(180deg, var(--paper), var(--paper2));
  border:1px solid var(--border);
  border-radius: 18px;
  box-shadow: 0 16px 40px var(--shadow); /* reduced */
  padding: 14px;
  max-height: 82vh;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  z-index: 90;
  opacity:0;
  pointer-events:none;
  transition: opacity .18s ease, transform .18s ease;
}
.modal.open{
  opacity:1;
  pointer-events:auto;
  transform: translate(-50%,-50%) scale(1);
}
.modal h3{margin:0 0 8px;font-size:16px}
.modal ul{margin:10px 0 0 18px;color:var(--muted);font-size:13px;line-height:1.5}

/* Help content tidying */
.helpSections{
  display: grid;
  gap: 10px;
  margin-top: 10px;
}
.helpSection{
  border: 1px solid var(--border);
  border-radius: 16px;
  background: color-mix(in oklab, var(--bg) 35%, var(--card));
  padding: 10px 12px;
}
.helpSection h4{
  margin: 0 0 6px;
  font-size: 13px;
  letter-spacing: .2px;
}
.helpSection ul{
  margin: 6px 0 0 18px;
}

/* Trouble modal + list */
.troubleModal{
  width: min(520px, 92vw);
}
.troubleList{
  margin-top: 12px;
  display: grid;
  gap: 10px;
}
.troubleRow{
  border: 1px solid var(--border);
  border-radius: 16px;
  background: color-mix(in oklab, var(--bg) 35%, var(--card));
  padding: 10px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
}
.troubleKana{
  font-size: 26px;
  font-weight: 950;
  line-height: 1;
  min-width: 40px;
}
.troubleMeta{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content:flex-end;
  align-items:center;
  color: var(--muted);
  font-size: 12px;
}
.troublePill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: color-mix(in oklab, var(--bg) 55%, var(--card));
  margin-right: 6px;
}
.troubleEmpty{
  border: 1px dashed var(--border);
  border-radius: 16px;
  padding: 12px;
  background: color-mix(in oklab, var(--bg) 22%, var(--card));
}

/* ✅ Version tag (bottom-right) */
.versionTag{
  position: fixed;
  right: calc(env(safe-area-inset-right) + 10px);
  bottom: calc(env(safe-area-inset-bottom) + 10px);
  font-size: 11px;
  color: var(--muted);
  opacity: .75;
  letter-spacing: .2px;
  user-select: none;
  pointer-events: auto;
  cursor: pointer;
  z-index: 40;
}

.versionTag:hover{
  opacity: 1;
  text-decoration: underline;
}

.versionTag:focus-visible{
  outline: 2px solid color-mix(in oklab, var(--accent) 70%, transparent);
  outline-offset: 4px;
  border-radius: 10px;
}

/* Smaller close button for welcome modal */
#closeHelpBtn.closeIcon{width:38px;height:38px}
#closeHelpBtn.closeIcon svg{width:18px;height:18px}


/* SEO content (crawlable, unobtrusive) */
.seoCard{
  margin-top: 14px;
}
.seoContent{
  text-align: left;
}
.seoContent h1{
  margin: 0 0 8px;
  font-size: 16px;
  font-weight: 950;
  letter-spacing: .2px;
}
.seoContent h2{
  margin: 12px 0 6px;
  font-size: 13px;
  font-weight: 900;
  letter-spacing: .2px;
  color: var(--text);
}
.seoContent p{
  margin: 8px 0;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.55;
}
.seoContent ul{
  margin: 8px 0 0 18px;
  color: var(--muted);
  font-size: 13px;
  line-height: 1.55;
}
.seoGrid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
  margin-top: 8px;
}
.seoBlock{
  border: 1px solid var(--border);
  border-radius: 16px;
  background: color-mix(in oklab, var(--bg) 35%, var(--card));
  padding: 10px 12px;
}
@media (max-width: 640px){
  .seoGrid{grid-template-columns: 1fr;}
}
